<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            min-height: 100vh;
        }
        
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .back-btn {
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
        }
        
        .setting-group {
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 10px;
            padding: 20px;
            margin: 15px 0;
        }
        
        .setting-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 15px 0;
        }
        
        .setting-label {
            flex: 1;
        }
        
        .setting-control {
            margin-left: 20px;
        }
        
        input[type="range"] {
            width: 150px;
        }
        
        input[type="checkbox"] {
            transform: scale(1.5);
        }
        
        select, input[type="text"] {
            padding: 8px;
            border: 1px solid #555;
            border-radius: 5px;
            background: #444;
            color: white;
        }
        
        .button {
            display: block;
            width: 100%;
            padding: 15px;
            margin: 10px 0;
            background: rgba(255,255,255,0.2);
            border: 2px solid rgba(255,255,255,0.3);
            border-radius: 10px;
            color: white;
            text-decoration: none;
            font-size: 16px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .button:hover {
            background: rgba(255,255,255,0.3);
        }
        
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 10px;
        }
        
        .status-ok { background: #4CAF50; }
        .status-error { background: #f44336; }
        .status-warning { background: #ff9800; }
    </style>
</head>
<body>
    <div class="header">
        <h1>‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏</h1>
        <button class="back-btn" onclick="goBack()">‚Üê –ù–∞–∑–∞–¥</button>
    </div>
    
    <!-- –°—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º—ã -->
    <div class="setting-group">
        <h3>üìä –°—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º—ã</h3>
        <div class="setting-item">
            <span>–†–∞–∑—Ä–µ—à–µ–Ω–∏–µ –Ω–∞ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø–æ–≤–µ—Ä—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π:</span>
            <span id="overlayStatus">
                <span class="status-indicator status-warning"></span>–ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è...
            </span>
        </div>
        <div class="setting-item">
            <span>–ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞ –≤ —Å–∏—Å—Ç–µ–º–µ:</span>
            <span id="keyboardStatus">
                <span class="status-indicator status-warning"></span>–ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è...
            </span>
        </div>
        <div class="setting-item">
            <span>–†–∞–∑—Ä–µ—à–µ–Ω–∏–µ –Ω–∞ –º–∏–∫—Ä–æ—Ñ–æ–Ω:</span>
            <span id="micStatus">
                <span class="status-indicator status-warning"></span>–ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è...
            </span>
        </div>
    </div>
    
    <!-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã -->
    <div class="setting-group">
        <h3>‚å®Ô∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã</h3>
        <div class="setting-item">
            <span>–†–∞–∑–º–µ—Ä –∫–Ω–æ–ø–æ–∫:</span>
            <div class="setting-control">
                <input type="range" id="buttonSize" min="30" max="80" value="50">
                <span id="buttonSizeValue">50px</span>
            </div>
        </div>
        <div class="setting-item">
            <span>–ü—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å:</span>
            <div class="setting-control">
                <input type="range" id="transparency" min="0" max="100" value="80">
                <span id="transparencyValue">80%</span>
            </div>
        </div>
        <div class="setting-item">
            <span>–í–∏–±—Ä–∞—Ü–∏—è –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏:</span>
            <div class="setting-control">
                <input type="checkbox" id="vibration" checked>
            </div>
        </div>
        <div class="setting-item">
            <span>–ó–≤—É–∫ –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏:</span>
            <div class="setting-control">
                <input type="checkbox" id="sound">
            </div>
        </div>
    </div>
    
    <!-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∫—Ä–∏–ø—Ç–æ–≤ -->
    <div class="setting-group">
        <h3>üìú –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∫—Ä–∏–ø—Ç–æ–≤</h3>
        <div class="setting-item">
            <span>–ê–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫–∞ —Å–∫—Ä–∏–ø—Ç–æ–≤:</span>
            <div class="setting-control">
                <input type="checkbox" id="autoloadScripts" checked>
            </div>
        </div>
        <div class="setting-item">
            <span>–ü–æ–∫–∞–∑—ã–≤–∞—Ç—å —Å–∫—Ä–∏–ø—Ç—ã –≤ –∫–ª–∞–≤–∏–∞—Ç—É—Ä–µ:</span>
            <div class="setting-control">
                <input type="checkbox" id="showScriptsInKeyboard" checked>
            </div>
        </div>
        <div class="setting-item">
            <span>–ú–∞–∫—Å–∏–º—É–º —Å–∫—Ä–∏–ø—Ç–æ–≤ –≤ —Ä—è–¥—É:</span>
            <div class="setting-control">
                <select id="maxScriptsInRow">
                    <option value="3">3</option>
                    <option value="5" selected>5</option>
                    <option value="7">7</option>
                </select>
            </div>
        </div>
    </div>
    
    <!-- –î–µ–π—Å—Ç–≤–∏—è -->
    <div class="setting-group">
        <h3>üîß –î–µ–π—Å—Ç–≤–∏—è</h3>
        <button class="button" onclick="requestPermissions()">
            üîê –ó–∞–ø—Ä–æ—Å–∏—Ç—å –≤—Å–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è
        </button>
        <button class="button" onclick="openKeyboardSettings()">
            ‚å®Ô∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã Android
        </button>
        <button class="button" onclick="exportSettings()">
            üì§ –≠–∫—Å–ø–æ—Ä—Ç –Ω–∞—Å—Ç—Ä–æ–µ–∫
        </button>
        <button class="button" onclick="importSettings()">
            üì• –ò–º–ø–æ—Ä—Ç –Ω–∞—Å—Ç—Ä–æ–µ–∫
        </button>
        <button class="button" onclick="resetSettings()" style="background: rgba(244, 67, 54, 0.3);">
            üîÑ –°–±—Ä–æ—Å–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
        </button>
    </div>
    
    <script src="cordova.js"></script>
    <script src="js/keyboard.js"></script>
    <script src="js/scripts.js"></script>
    <script>
        // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
        const defaultSettings = {
            buttonSize: 50,
            transparency: 80,
            vibration: true,
            sound: false,
            autoloadScripts: true,
            showScriptsInKeyboard: true,
            maxScriptsInRow: 5
        };
        
        let currentSettings = {...defaultSettings};
        
        document.addEventListener('deviceready', function() {
            loadSettings();
            checkSystemStatus();
            setupEventListeners();
        }, false);
        
        function loadSettings() {
            const saved = localStorage.getItem('keyboardSettings');
            if (saved) {
                try {
                    currentSettings = {...defaultSettings, ...JSON.parse(saved)};
                } catch (e) {
                    console.log('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫, –∏—Å–ø–æ–ª—å–∑—É–µ–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é');
                }
            }
            
            // –ü—Ä–∏–º–µ–Ω—è–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∫ —ç–ª–µ–º–µ–Ω—Ç–∞–º
            document.getElementById('buttonSize').value = currentSettings.buttonSize;
            document.getElementById('buttonSizeValue').textContent = currentSettings.buttonSize + 'px';
            
            document.getElementById('transparency').value = currentSettings.transparency;
            document.getElementById('transparencyValue').textContent = currentSettings.transparency + '%';
            
            document.getElementById('vibration').checked = currentSettings.vibration;
            document.getElementById('sound').checked = currentSettings.sound;
            document.getElementById('autoloadScripts').checked = currentSettings.autoloadScripts;
            document.getElementById('showScriptsInKeyboard').checked = currentSettings.showScriptsInKeyboard;
            document.getElementById('maxScriptsInRow').value = currentSettings.maxScriptsInRow;
        }
        
        function saveSettings() {
            localStorage.setItem('keyboardSettings', JSON.stringify(currentSettings));
        }
        
        function setupEventListeners() {
            // –†–∞–∑–º–µ—Ä –∫–Ω–æ–ø–æ–∫
            document.getElementById('buttonSize').addEventListener('input', function() {
                currentSettings.buttonSize = parseInt(this.value);
                document.getElementById('buttonSizeValue').textContent = this.value + 'px';
                saveSettings();
            });
            
            // –ü—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å
            document.getElementById('transparency').addEventListener('input', function() {
                currentSettings.transparency = parseInt(this.value);
                document.getElementById('transparencyValue').textContent = this.value + '%';
                saveSettings();
            });
            
            // –û—Å—Ç–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
            ['vibration', 'sound', 'autoloadScripts', 'showScriptsInKeyboard'].forEach(id => {
                document.getElementById(id).addEventListener('change', function() {
                    currentSettings[id] = this.checked;
                    saveSettings();
                });
            });
            
            document.getElementById('maxScriptsInRow').addEventListener('change', function() {
                currentSettings.maxScriptsInRow = parseInt(this.value);
                saveSettings();
            });
        }
        
        function checkSystemStatus() {
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π (–∑–∞–≥–ª—É—à–∫–∏, –≤ —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –±—É–¥—É—Ç –Ω–∞—Ç–∏–≤–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏)
            setTimeout(() => {
                document.getElementById('overlayStatus').innerHTML = 
                    '<span class="status-indicator status-ok"></span>–†–∞–∑—Ä–µ—à–µ–Ω–æ';
                document.getElementById('keyboardStatus').innerHTML = 
                    '<span class="status-indicator status-warning"></span>–ù–µ –∞–∫—Ç–∏–≤–Ω–∞';
                document.getElementById('micStatus').innerHTML = 
                    '<span class="status-indicator status-ok"></span>–†–∞–∑—Ä–µ—à–µ–Ω–æ';
            }, 1000);
        }
        
        function requestPermissions() {
            alert('–§—É–Ω–∫—Ü–∏—è –∑–∞–ø—Ä–æ—Å–∞ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π –±—É–¥–µ—Ç —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –≤ –Ω–∞—Ç–∏–≤–Ω–æ–º –ø–ª–∞–≥–∏–Ω–µ');
        }
        
        function openKeyboardSettings() {
            try {
                // –ü–æ–ø—ã—Ç–∫–∞ –æ—Ç–∫—Ä—ã—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã
                window.open('android-app://com.android.settings/.Settings$InputMethodAndLanguageSettingsActivity', '_system');
            } catch (e) {
                alert('–û—Ç–∫—Ä–æ–π—Ç–µ –ù–∞—Å—Ç—Ä–æ–π–∫–∏ ‚Üí –Ø–∑—ã–∫ –∏ –≤–≤–æ–¥ ‚Üí –ö–ª–∞–≤–∏–∞—Ç—É—Ä—ã');
            }
        }
        
        function exportSettings() {
            const data = {
                settings: currentSettings,
                scripts: ScriptManager.getAllScripts().filter(s => s.userCreated),
                timestamp: new Date().toISOString()
            };
            
            const blob = new Blob([JSON.stringify(data, null, 2)], {type: 'application/json'});
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = 'keyboard_settings.json';
            a.click();
            
            URL.revokeObjectURL(url);
        }
        
        function importSettings() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        try {
                            const data = JSON.parse(e.target.result);
                            
                            if (data.settings) {
                                currentSettings = {...defaultSettings, ...data.settings};
                                saveSettings();
                                loadSettings();
                            }
                            
                            if (data.scripts) {
                                data.scripts.forEach(script => {
                                    ScriptManager.addScript(script);
                                });
                                ScriptManager.saveUserScripts();
                            }
                            
                            alert('–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã —É—Å–ø–µ—à–Ω–æ!');
                        } catch (e) {
                            alert('–û—à–∏–±–∫–∞ –∏–º–ø–æ—Ä—Ç–∞: ' + e.message);
                        }
                    };
                    reader.readAsText(file);
                }
            };
            
            input.click();
        }
        
        function resetSettings() {
            if (confirm('–°–±—Ä–æ—Å–∏—Ç—å –≤—Å–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∫ –∑–Ω–∞—á–µ–Ω–∏—è–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é?')) {
                currentSettings = {...defaultSettings};
                saveSettings();
                loadSettings();
                alert('–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–±—Ä–æ—à–µ–Ω—ã');
            }
        }
        
        function goBack() {
            window.location.href = 'index.html';
        }
        
        // –ü–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—É—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (–¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ –¥—Ä—É–≥–∏—Ö –º–æ–¥—É–ª—è—Ö)
        window.getKeyboardSettings = function() {
            return currentSettings;
        };
    </script>
</body>
</html>